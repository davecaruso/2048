import React, { SVGProps, useCallback } from 'react'
import styles from '../css/LoseOverlay.module.css';
import clsx from 'clsx';
import { connect } from 'react-redux';
import { IStore } from '../store';
import { motion } from 'framer-motion';
import { start } from '../actions';

function LoseOverlay({
    score,
    highestTileThisGame,
    visible,
    className,
    start,
    ...props
  }: (SVGProps<any> & {
    highestTileThisGame: number,
    score: number,
    visible: boolean,
    start: VoidFunction,
  })
) {
  const share = useCallback(() => {
    window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(`I scored ${score} and got the ${highestTileThisGame} Tile on @imdaveead's 2048 clone! https://davecode.me/2048`));
  }, [score, highestTileThisGame]);

  return (
    <svg
      width="452"
      height="452"
      viewBox="0 0 452 452"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className={clsx(styles.root, visible && styles.lose, className)}
      {...props}
    >
      <rect width="452" height="452" fill="#252525" fill-opacity="0.65" />
      <path d="M107.25 126.094C105.604 128.24 103.323 129.865 100.406 130.969C97.4896 132.073 94.1771 132.625 90.4688 132.625C86.6562 132.625 83.2812 131.76 80.3438 130.031C77.4062 128.302 75.1354 125.833 73.5312 122.625C71.9479 119.396 71.125 115.635 71.0625 111.344V107.781C71.0625 100.906 72.7083 95.5417 76 91.6875C79.2917 87.8125 83.8854 85.875 89.7812 85.875C94.8438 85.875 98.8646 87.125 101.844 89.625C104.823 92.125 106.615 95.7292 107.219 100.438H99.4688C98.5938 94.9583 95.4167 92.2188 89.9375 92.2188C86.3958 92.2188 83.6979 93.5 81.8438 96.0625C80.0104 98.6042 79.0625 102.344 79 107.281V110.781C79 115.698 80.0312 119.521 82.0938 122.25C84.1771 124.958 87.0625 126.312 90.75 126.312C94.7917 126.312 97.6667 125.396 99.375 123.562V114.656H90V108.656H107.25V126.094ZM135.406 132C135.073 131.354 134.781 130.302 134.531 128.844C132.115 131.365 129.156 132.625 125.656 132.625C122.26 132.625 119.49 131.656 117.344 129.719C115.198 127.781 114.125 125.385 114.125 122.531C114.125 118.927 115.458 116.167 118.125 114.25C120.812 112.312 124.646 111.344 129.625 111.344H134.281V109.125C134.281 107.375 133.792 105.979 132.812 104.938C131.833 103.875 130.344 103.344 128.344 103.344C126.615 103.344 125.198 103.781 124.094 104.656C122.99 105.51 122.438 106.604 122.438 107.938H114.844C114.844 106.083 115.458 104.354 116.688 102.75C117.917 101.125 119.583 99.8542 121.688 98.9375C123.812 98.0208 126.177 97.5625 128.781 97.5625C132.74 97.5625 135.896 98.5625 138.25 100.562C140.604 102.542 141.812 105.333 141.875 108.938V124.188C141.875 127.229 142.302 129.656 143.156 131.469V132H135.406ZM127.062 126.531C128.562 126.531 129.969 126.167 131.281 125.438C132.615 124.708 133.615 123.729 134.281 122.5V116.125H130.188C127.375 116.125 125.26 116.615 123.844 117.594C122.427 118.573 121.719 119.958 121.719 121.75C121.719 123.208 122.198 124.375 123.156 125.25C124.135 126.104 125.438 126.531 127.062 126.531ZM156.969 98.1875L157.188 101.719C159.562 98.9479 162.812 97.5625 166.938 97.5625C171.458 97.5625 174.552 99.2917 176.219 102.75C178.677 99.2917 182.135 97.5625 186.594 97.5625C190.323 97.5625 193.094 98.5938 194.906 100.656C196.74 102.719 197.677 105.76 197.719 109.781V132H190.125V110C190.125 107.854 189.656 106.281 188.719 105.281C187.781 104.281 186.229 103.781 184.062 103.781C182.333 103.781 180.917 104.25 179.812 105.188C178.729 106.104 177.969 107.312 177.531 108.812L177.562 132H169.969V109.75C169.865 105.771 167.833 103.781 163.875 103.781C160.833 103.781 158.677 105.021 157.406 107.5V132H149.812V98.1875H156.969ZM220.406 132.625C215.594 132.625 211.688 131.115 208.688 128.094C205.708 125.052 204.219 121.01 204.219 115.969V115.031C204.219 111.656 204.865 108.646 206.156 106C207.469 103.333 209.302 101.26 211.656 99.7812C214.01 98.3021 216.635 97.5625 219.531 97.5625C224.135 97.5625 227.688 99.0312 230.188 101.969C232.708 104.906 233.969 109.062 233.969 114.438V117.5H211.875C212.104 120.292 213.031 122.5 214.656 124.125C216.302 125.75 218.365 126.562 220.844 126.562C224.323 126.562 227.156 125.156 229.344 122.344L233.438 126.25C232.083 128.271 230.271 129.844 228 130.969C225.75 132.073 223.219 132.625 220.406 132.625ZM219.5 103.656C217.417 103.656 215.729 104.385 214.438 105.844C213.167 107.302 212.354 109.333 212 111.938H226.469V111.375C226.302 108.833 225.625 106.917 224.438 105.625C223.25 104.312 221.604 103.656 219.5 103.656ZM292.875 110.438C292.875 114.896 292.104 118.812 290.562 122.188C289.021 125.542 286.812 128.125 283.938 129.938C281.083 131.729 277.792 132.625 274.062 132.625C270.375 132.625 267.083 131.729 264.188 129.938C261.312 128.125 259.083 125.552 257.5 122.219C255.938 118.885 255.146 115.042 255.125 110.688V108.125C255.125 103.688 255.906 99.7708 257.469 96.375C259.052 92.9792 261.271 90.3854 264.125 88.5938C267 86.7812 270.292 85.875 274 85.875C277.708 85.875 280.99 86.7708 283.844 88.5625C286.719 90.3333 288.938 92.8958 290.5 96.25C292.062 99.5833 292.854 103.469 292.875 107.906V110.438ZM284.969 108.062C284.969 103.021 284.01 99.1562 282.094 96.4688C280.198 93.7812 277.5 92.4375 274 92.4375C270.583 92.4375 267.906 93.7812 265.969 96.4688C264.052 99.1354 263.073 102.917 263.031 107.812V110.438C263.031 115.438 264 119.302 265.938 122.031C267.896 124.76 270.604 126.125 274.062 126.125C277.562 126.125 280.25 124.792 282.125 122.125C284.021 119.458 284.969 115.562 284.969 110.438V108.062ZM311.938 122.375L319.094 98.1875H326.938L315.219 132H308.625L296.812 98.1875H304.688L311.938 122.375ZM346.156 132.625C341.344 132.625 337.438 131.115 334.438 128.094C331.458 125.052 329.969 121.01 329.969 115.969V115.031C329.969 111.656 330.615 108.646 331.906 106C333.219 103.333 335.052 101.26 337.406 99.7812C339.76 98.3021 342.385 97.5625 345.281 97.5625C349.885 97.5625 353.438 99.0312 355.938 101.969C358.458 104.906 359.719 109.062 359.719 114.438V117.5H337.625C337.854 120.292 338.781 122.5 340.406 124.125C342.052 125.75 344.115 126.562 346.594 126.562C350.073 126.562 352.906 125.156 355.094 122.344L359.188 126.25C357.833 128.271 356.021 129.844 353.75 130.969C351.5 132.073 348.969 132.625 346.156 132.625ZM345.25 103.656C343.167 103.656 341.479 104.385 340.188 105.844C338.917 107.302 338.104 109.333 337.75 111.938H352.219V111.375C352.052 108.833 351.375 106.917 350.188 105.625C349 104.312 347.354 103.656 345.25 103.656ZM383.344 105.125C382.344 104.958 381.312 104.875 380.25 104.875C376.771 104.875 374.427 106.208 373.219 108.875V132H365.625V98.1875H372.875L373.062 101.969C374.896 99.0312 377.438 97.5625 380.688 97.5625C381.771 97.5625 382.667 97.7083 383.375 98L383.344 105.125Z" fill="white" />
      <text
        x='226px' y='200px' fontSize='30px' fill='white'
        textAnchor="middle" alignmentBaseline="middle"
      >
        Score: {score}
      </text>
      <text
        x='226px' y='240px' fontSize='30px' fill='white'
        textAnchor="middle" alignmentBaseline="middle"
      >
        Highest Tile: {highestTileThisGame}
      </text>
      <motion.g
        onClick={start}
        whileHover={{ scale: 1.01 }}
        whileTap={{ scale: 0.95 }}
      >
        <path d="M42 307H186V317H196V363H186V373H42V363H32V317H42V307Z" fill="white" />
        <path d="M50.8945 341.988V348H47.3789V330.938H54.0352C55.3164 330.938 56.4414 331.172 57.4102 331.641C58.3867 332.109 59.1367 332.777 59.6602 333.645C60.1836 334.504 60.4453 335.484 60.4453 336.586C60.4453 338.258 59.8711 339.578 58.7227 340.547C57.582 341.508 56 341.988 53.9766 341.988H50.8945ZM50.8945 339.141H54.0352C54.9648 339.141 55.6719 338.922 56.1562 338.484C56.6484 338.047 56.8945 337.422 56.8945 336.609C56.8945 335.773 56.6484 335.098 56.1562 334.582C55.6641 334.066 54.9844 333.801 54.1172 333.785H50.8945V339.141ZM66.3867 345.176H73.8516V348H62.8711V330.938H66.3867V345.176ZM85.7461 344.484H79.582L78.4102 348H74.6719L81.0234 330.938H84.2812L90.668 348H86.9297L85.7461 344.484ZM80.5312 341.637H84.7969L82.6523 335.25L80.5312 341.637ZM96.3867 338.625L99.9375 330.938H103.781L98.1797 341.812V348H94.6055V341.812L89.0039 330.938H92.8594L96.3867 338.625ZM120.949 344.484H114.785L113.613 348H109.875L116.227 330.938H119.484L125.871 348H122.133L120.949 344.484ZM115.734 341.637H120L117.855 335.25L115.734 341.637ZM140.707 345.844C140.074 346.602 139.18 347.191 138.023 347.613C136.867 348.027 135.586 348.234 134.18 348.234C132.703 348.234 131.406 347.914 130.289 347.273C129.18 346.625 128.32 345.688 127.711 344.461C127.109 343.234 126.801 341.793 126.785 340.137V338.977C126.785 337.273 127.07 335.801 127.641 334.559C128.219 333.309 129.047 332.355 130.125 331.699C131.211 331.035 132.48 330.703 133.934 330.703C135.957 330.703 137.539 331.188 138.68 332.156C139.82 333.117 140.496 334.52 140.707 336.363H137.285C137.129 335.387 136.781 334.672 136.242 334.219C135.711 333.766 134.977 333.539 134.039 333.539C132.844 333.539 131.934 333.988 131.309 334.887C130.684 335.785 130.367 337.121 130.359 338.895V339.984C130.359 341.773 130.699 343.125 131.379 344.039C132.059 344.953 133.055 345.41 134.367 345.41C135.688 345.41 136.629 345.129 137.191 344.566V341.625H133.992V339.035H140.707V345.844ZM153.199 344.484H147.035L145.863 348H142.125L148.477 330.938H151.734L158.121 348H154.383L153.199 344.484ZM147.984 341.637H152.25L150.105 335.25L147.984 341.637ZM163.453 348H159.938V330.938H163.453V348ZM180.598 348H177.082L170.238 336.773V348H166.723V330.938H170.238L177.094 342.188V330.938H180.598V348Z" fill="black" />
      </motion.g>
      <motion.g
        onClick={share}
        whileHover={{ scale: 1.01 }}
        whileTap={{ scale: 0.95 }}
      >
        <path d="M266 307H410V317H420V363H410V373H266V363H256V317H266V307Z" fill="white" />
        <path d="M309.91 343.523C309.91 342.859 309.676 342.352 309.207 342C308.738 341.641 307.895 341.266 306.676 340.875C305.457 340.477 304.492 340.086 303.781 339.703C301.844 338.656 300.875 337.246 300.875 335.473C300.875 334.551 301.133 333.73 301.648 333.012C302.172 332.285 302.918 331.719 303.887 331.312C304.863 330.906 305.957 330.703 307.168 330.703C308.387 330.703 309.473 330.926 310.426 331.371C311.379 331.809 312.117 332.43 312.641 333.234C313.172 334.039 313.438 334.953 313.438 335.977H309.922C309.922 335.195 309.676 334.59 309.184 334.16C308.691 333.723 308 333.504 307.109 333.504C306.25 333.504 305.582 333.688 305.105 334.055C304.629 334.414 304.391 334.891 304.391 335.484C304.391 336.039 304.668 336.504 305.223 336.879C305.785 337.254 306.609 337.605 307.695 337.934C309.695 338.535 311.152 339.281 312.066 340.172C312.98 341.062 313.438 342.172 313.438 343.5C313.438 344.977 312.879 346.137 311.762 346.98C310.645 347.816 309.141 348.234 307.25 348.234C305.938 348.234 304.742 347.996 303.664 347.52C302.586 347.035 301.762 346.375 301.191 345.539C300.629 344.703 300.348 343.734 300.348 342.633H303.875C303.875 344.516 305 345.457 307.25 345.457C308.086 345.457 308.738 345.289 309.207 344.953C309.676 344.609 309.91 344.133 309.91 343.523ZM329.715 348H326.199V340.688H319.344V348H315.828V330.938H319.344V337.852H326.199V330.938H329.715V348ZM342.641 344.484H336.477L335.305 348H331.566L337.918 330.938H341.176L347.562 348H343.824L342.641 344.484ZM337.426 341.637H341.691L339.547 335.25L337.426 341.637ZM355.473 341.754H352.672V348H349.156V330.938H355.496C357.512 330.938 359.066 331.387 360.16 332.285C361.254 333.184 361.801 334.453 361.801 336.094C361.801 337.258 361.547 338.23 361.039 339.012C360.539 339.785 359.777 340.402 358.754 340.863L362.445 347.836V348H358.672L355.473 341.754ZM352.672 338.906H355.508C356.391 338.906 357.074 338.684 357.559 338.238C358.043 337.785 358.285 337.164 358.285 336.375C358.285 335.57 358.055 334.938 357.594 334.477C357.141 334.016 356.441 333.785 355.496 333.785H352.672V338.906ZM374.75 340.605H368V345.176H375.922V348H364.484V330.938H375.898V333.785H368V337.852H374.75V340.605Z" fill="black" />
      </motion.g>
    </svg>
  )
}

export default connect(
  (state: IStore) => ({
    score: state.game.score,
    highestTileThisGame: state.game.highestTileThisGame,
  }),
  { start },
)(LoseOverlay);
